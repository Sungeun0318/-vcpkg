From de82ae3c82dc4913949e8a884f1cff911dc7ec31 Mon Sep 17 00:00:00 2001
From: Vitaly Buka <vitalybuka@google.com>
Date: Mon, 24 Apr 2023 17:19:46 -0700
Subject: [PATCH] Switch to requires_utf8_validation

descriptor()->file()->syntax() will be
private soon.
---
 src/field_instance.h | 6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

diff --git a/src/field_instance.h b/src/field_instance.h
index 11ccd27..487996b 100644
--- a/src/field_instance.h
+++ b/src/field_instance.h
@@ -190,11 +190,7 @@ class ConstFieldInstance {
     return descriptor_->message_type();
   }
 
-  bool EnforceUtf8() const {
-    return descriptor_->type() == protobuf::FieldDescriptor::TYPE_STRING &&
-           descriptor()->file()->syntax() ==
-               protobuf::FileDescriptor::SYNTAX_PROTO3;
-  }
+  bool EnforceUtf8() const { return descriptor_->requires_utf8_validation(); }
 
   const protobuf::FieldDescriptor* descriptor() const { return descriptor_; }
 

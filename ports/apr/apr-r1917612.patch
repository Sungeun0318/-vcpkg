Index: CMakeLists.txt
===================================================================
--- CMakeLists.txt	(revision 1917611)
+++ CMakeLists.txt	(revision 1917612)
@@ -74,6 +74,13 @@
   SET(win32_winnt_str ${MIN_WINDOWS_VER})
 ENDIF()
 
+# Read current version.
+FILE(STRINGS include/apr_version.h VERSION_STRINGS REGEX "#define (APR_MAJOR_VERSION|APR_MINOR_VERSION|APR_PATCH_VERSION)")
+
+STRING(REGEX REPLACE ".*#define APR_MAJOR_VERSION[ \t]+([0-9]+).*" "\\1" APR_MAJOR_VERSION ${VERSION_STRINGS})
+STRING(REGEX REPLACE ".*#define APR_MINOR_VERSION[ \t]+([0-9]+).*" "\\1" APR_MINOR_VERSION ${VERSION_STRINGS})
+STRING(REGEX REPLACE ".*#define APR_PATCH_VERSION[ \t]+([0-9]+).*" "\\1" APR_PATCH_VERSION ${VERSION_STRINGS})
+
 CONFIGURE_FILE(include/apr.hwc
                ${PROJECT_BINARY_DIR}/apr.h)
 
@@ -449,8 +456,15 @@
 ENDIF (APR_BUILD_TESTAPR)
 
 # Installation
+INCLUDE(CMakePackageConfigHelpers)
+
 string(TOLOWER "${PROJECT_NAME}" project_name_lower)
 
+write_basic_package_version_file("${CMAKE_CURRENT_BINARY_DIR}/${project_name_lower}-config-version.cmake"
+  VERSION ${APR_MAJOR_VERSION}.${APR_MINOR_VERSION}.${APR_PATCH_VERSION}
+  COMPATIBILITY SameMajorVersion
+)
+
 INSTALL(TARGETS ${install_targets} EXPORT apr-config
         RUNTIME DESTINATION bin
         LIBRARY DESTINATION lib
@@ -463,6 +477,10 @@
         FILE "${project_name_lower}-config.cmake"
 )
 
+INSTALL(FILES "${CMAKE_CURRENT_BINARY_DIR}/${project_name_lower}-config-version.cmake"
+        DESTINATION "lib/cmake/${project_name_lower}"
+)
+
 IF(INSTALL_PDB)
   INSTALL(FILES ${install_bin_pdb}
           DESTINATION bin
Index: .
===================================================================
--- .	(revision 1917611)
+++ .	(revision 1917612)

Property changes on: .
___________________________________________________________________
Modified: svn:mergeinfo
## -0,0 +0,1 ##
   Merged /apr/apr/trunk:r1917604

